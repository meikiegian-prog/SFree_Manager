<!-- 数据统计页 - HCI：可视化图表、语音解读、时间筛选 -->
<view class="statistics-page">
  <!-- 时间筛选器 -->
  <view class="filter-section p-20">
    <view class="filter-type">
      <radio-group bindchange="onFilterTypeChange">
        <label class="filter-option">
          <radio value="all" checked="{{filterType === 'all'}}"/> 全部
        </label>
        <label class="filter-option">
          <radio value="year" checked="{{filterType === 'year'}}"/> 按年
        </label>
        <label class="filter-option">
          <radio value="month" checked="{{filterType === 'month'}}"/> 按月
        </label>
      </radio-group>
    </view>
    
    <!-- 年份选择器 -->
    <view class="filter-control" wx:if="{{filterType === 'year' || filterType === 'month'}}">
      <text class="filter-label">选择年份：</text>
      <picker 
        range="{{years}}" 
        value="{{years.indexOf(filterYear)}}" 
        bindchange="onYearChange"
        class="filter-picker"
      >
        <view class="picker-value">{{filterYear}}年</view>
      </picker>
    </view>
    
    <!-- 月份选择器 -->
    <view class="filter-control" wx:if="{{filterType === 'month'}}">
      <text class="filter-label">选择月份：</text>
      <picker 
        range="{{months}}" 
        value="{{filterMonth - 1}}" 
        bindchange="onMonthChange"
        class="filter-picker"
      >
        <view class="picker-value">{{filterMonth}}月</view>
      </picker>
    </view>
  </view>

  <!-- 切换统计维度 -->
  <view class="tab-bar">
    <button 
      class="tab-btn {{activeTab === 'time' ? 'active' : ''}}"
      bindtap="switchTab"
      data-type="time"
    >
      时间分配
    </button>
    <button 
      class="tab-btn {{activeTab === 'income' ? 'active' : ''}}"
      bindtap="switchTab"
      data-type="income"
    >
      收入统计
    </button>
  </view>

	  <!-- ECharts图表容器（核心可视化） -->
	  <view class="chart-container">
	    <ec-canvas 
	      id="mychart-dom" 
	      canvas-id="mychart" 
	      ec="{{ec}}"
	      type="2d"
	    ></ec-canvas>
	  </view>

  <!-- 数据汇总 -->
  <view class="data-summary p-30">
    <view class="summary-item">
      <text class="summary-label">筛选项目数</text>
      <text class="summary-value">{{filteredProjectList.length}}</text>
    </view>
    <view class="summary-item">
      <text class="summary-label">总工作时长</text>
      <text class="summary-value">{{formattedTotalTime}}</text>
    </view>
    <view class="summary-item">
      <text class="summary-label">总收入</text>
      <text class="summary-value">¥{{totalIncome}}</text>
    </view>
  </view>

	  <!-- 已完成项目列表 -->
	  <view class="completed-projects-section" wx:if="{{filteredProjectList.length > 0}}">
	    <view class="section-header">
	      <view class="section-title-container">
	        <text class="section-title">已完成项目</text>
	        <button 
	          class="manage-btn {{isManageMode ? 'active' : ''}}"
	          bindtap="toggleManageMode"
	        >
	          {{isManageMode ? '完成管理' : '管理'}}
	        </button>
	      </view>
	      <text class="section-subtitle">共{{filteredProjectList.length}}个项目已完成</text>
	    </view>
	    
	    <view class="completed-projects-list">
	      <project-card 
	        wx:for="{{filteredProjectList}}" 
	        wx:key="id"
	        project="{{item}}"
	        is-manage-mode="{{isManageMode}}"
	        bind:finishProject="handleFinishProject"
	        bind:deleteProject="onDeleteProject"
	      />
	    </view>
	  </view>
</view>